<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moje prvnÃ­ REST API - chyby a pouÄenÃ­ | codebydejv</title>
  <meta name="description" content="Co vÅ¡echno jsem pokazil pÅ™i tvorbÄ› prvnÃ­ho REST API a jak jsem se z toho pouÄil. PraktickÃ© tipy pro zaÄÃ¡teÄnÃ­ky." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’»</text></svg>" />
</head>
<body>
  <header class="site-header">
    <div class="container row header-inner">
      <a class="brand" href="../index.html">
        <span class="brand-brackets">&lt;/&gt;</span>
        <span class="brand-text">codebydejv</span>
      </a>
      <nav class="nav">
        <a href="../index.html#o-mne">O mnÄ›</a>
        <a href="../index.html#projekty">Projekty</a>
        <a href="../index.html#clanky">ÄŒlÃ¡nky</a>
        <a href="../index.html#kontakt">Kontakt</a>
      </nav>
    </div>
  </header>

  <main class="article-main">
    <div class="container">
      <article class="article">
        <header class="article-header">
          <div class="article-meta">
            <span class="article-date">20. Äervna 2025</span>
            <span class="article-read-time">6 min ÄtenÃ­</span>
          </div>
          <h1>Moje prvnÃ­ REST API - chyby a pouÄenÃ­</h1>
          <p class="article-excerpt">
            Co vÅ¡echno jsem pokazil pÅ™i tvorbÄ› prvnÃ­ho REST API a jak jsem se z toho pouÄil. PraktickÃ© tipy pro zaÄÃ¡teÄnÃ­ky.
          </p>
          <div class="article-tags">
            <span class="tag">REST API</span>
            <span class="tag">Spring</span>
            <span class="tag">ZaÄÃ¡teÄnÃ­k</span>
          </div>
        </header>

        <div class="article-content">
          <p>
            PamatujeÅ¡ si svÃ© prvnÃ­ auto? To prvnÃ­ API je podobnÃ© - je to vzruÅ¡ujÃ­cÃ­, 
            ale taky dÄ›sivÃ©, protoÅ¾e nevÃ­Å¡, co vÅ¡echno mÅ¯Å¾eÅ¡ pokazit. JÃ¡ jsem toho pokazil hodnÄ›. 
            A pÅ™esnÄ› o tom je tenhle ÄlÃ¡nek.
          </p>

          <h2>ğŸ¯ MÅ¯j prvnÃ­ projekt: SprÃ¡vce pojiÅ¡tÄ›nÃ­</h2>
          <p>
            Rozhodl jsem se vytvoÅ™it API pro sprÃ¡vu pojiÅ¡tÄ›nÃ­. ZdÃ¡lo se mi to jednoduchÃ©: 
            CRUD operace, pÃ¡r endpointÅ¯, databÃ¡ze. Co mÅ¯Å¾e bÃ½t tak tÄ›Å¾kÃ©ho, ne?
          </p>
          
          <p>
            <strong>Spoiler alert:</strong> VÅ¡echno. VÅ¡echno mÅ¯Å¾e bÃ½t tÄ›Å¾kÃ©, kdyÅ¾ nevÃ­Å¡, co dÄ›lÃ¡Å¡. ğŸ˜…
          </p>

          <h2>âŒ Chyba #1: VÅ¡echno v jednom controlleru</h2>
          
          <h3>Co jsem udÄ›lal Å¡patnÄ›:</h3>
          <pre><code>@RestController
public class EverythingController {
    
    // Policies
    @GetMapping("/policies")
    public List&lt;Policy&gt; getPolicies() { ... }
    
    @PostMapping("/policies")
    public Policy createPolicy(@RequestBody Policy policy) { ... }
    
    // Clients  
    @GetMapping("/clients")
    public List&lt;Client&gt; getClients() { ... }
    
    @PostMapping("/clients") 
    public Client createClient(@RequestBody Client client) { ... }
    
    // Claims
    @GetMapping("/claims")
    public List&lt;Claim&gt; getClaims() { ... }
    
    // ... dalÅ¡Ã­ 20 endpointÅ¯
}</code></pre>

          <p>
            Jeden controller s 25 endpointy. Soubor dlouhÃ½ 500 Å™Ã¡dkÅ¯. 
            HledÃ¡nÃ­ konkrÃ©tnÃ­ metody bylo jako hledÃ¡nÃ­ jehly v kupce sena.
          </p>

          <h3>âœ… Jak to Å™eÅ¡Ã­m dnes:</h3>
          <pre><code>@RestController
@RequestMapping("/api/policies")
public class PolicyController {
    // Jen operace s pojiÅ¡tÄ›nÃ­mi
}

@RestController
@RequestMapping("/api/clients")
public class ClientController {
    // Jen operace s klienty
}

@RestController
@RequestMapping("/api/claims")
public class ClaimController {
    // Jen operace s Å¡kodami
}</code></pre>

          <blockquote>
            <p>
              <strong>PouÄenÃ­:</strong> Jeden controller = jedna domÃ©na. 
              Pokud mÃ¡ controller vÃ­c neÅ¾ 10 endpointÅ¯, je Äas ho rozdÄ›lit.
            </p>
          </blockquote>

          <h2>âŒ Chyba #2: Entity pÅ™Ã­mo v API</h2>
          
          <h3>Co jsem udÄ›lal Å¡patnÄ›:</h3>
          <pre><code>@Entity
@Table(name = "policies")
public class Policy {
    @Id
    @GeneratedValue
    private Long id;
    
    private String number;
    private BigDecimal amount;
    private String clientPassword; // ğŸ˜± Heslo v responsu!
    private LocalDateTime createdAt;
    
    // ... vÅ¡echny database sloupce
}</code></pre>

          <p>
            VrÃ¡til jsem Entity pÅ™Ã­mo z API. VÃ½sledek? Hesla v JSON responsech, 
            zbyteÄnÃ¡ data, lazy loading exceptions a celkovÃ½ chaos.
          </p>

          <h3>âœ… Jak to Å™eÅ¡Ã­m dnes:</h3>
          <pre><code>// DTO pro response
public class PolicyDto {
    private Long id;
    private String number;
    private BigDecimal amount;
    private String clientName; // Jen jmÃ©no, ne celÃ½ objekt
    private LocalDateTime createdAt;
}

// DTO pro vytvoÅ™enÃ­
public class CreatePolicyDto {
    @NotBlank(message = "ÄŒÃ­slo pojiÅ¡tÄ›nÃ­ je povinnÃ©")
    private String number;
    
    @NotNull(message = "ÄŒÃ¡stka je povinnÃ¡")
    @DecimalMin(value = "0.01", message = "ÄŒÃ¡stka musÃ­ bÃ½t vÄ›tÅ¡Ã­ neÅ¾ 0")
    private BigDecimal amount;
    
    @NotNull(message = "ID klienta je povinnÃ©")
    private Long clientId;
}

// Controller
@PostMapping
public PolicyDto createPolicy(@Valid @RequestBody CreatePolicyDto dto) {
    Policy policy = policyService.create(dto);
    return policyMapper.toDto(policy);
}</code></pre>

          <blockquote>
            <p>
              <strong>PouÄenÃ­:</strong> Entity â‰  DTO. API mÃ¡ svoje rozhranÃ­, 
              databÃ¡ze mÃ¡ svoje. Nikdy je nemixtuj.
            </p>
          </blockquote>

          <h2>âŒ Chyba #3: Å½Ã¡dnÃ¡ validace</h2>
          
          <h3>Co jsem udÄ›lal Å¡patnÄ›:</h3>
          <pre><code>@PostMapping("/policies")
public Policy createPolicy(@RequestBody Policy policy) {
    // Å½Ã¡dnÃ¡ validace, jen uloÅ¾Ã­m co pÅ™ijde
    return policyRepository.save(policy);
}</code></pre>

          <p>
            VÃ½sledek: PrÃ¡zdnÃ¡ ÄÃ­sla pojiÅ¡tÄ›nÃ­, negativnÃ­ ÄÃ¡stky, null hodnoty vÅ¡ude. 
            DatabÃ¡ze byla plnÃ¡ smetÃ­.
          </p>

          <h3>âœ… Jak to Å™eÅ¡Ã­m dnes:</h3>
          <pre><code>public class CreatePolicyDto {
    @NotBlank(message = "ÄŒÃ­slo pojiÅ¡tÄ›nÃ­ je povinnÃ©")
    @Size(min = 8, max = 20, message = "ÄŒÃ­slo pojiÅ¡tÄ›nÃ­ musÃ­ mÃ­t 8-20 znakÅ¯")
    private String number;
    
    @NotNull(message = "ÄŒÃ¡stka je povinnÃ¡")
    @DecimalMin(value = "0.01", message = "ÄŒÃ¡stka musÃ­ bÃ½t vÄ›tÅ¡Ã­ neÅ¾ 0")
    @DecimalMax(value = "10000000", message = "ÄŒÃ¡stka je pÅ™Ã­liÅ¡ vysokÃ¡")
    private BigDecimal amount;
    
    @NotNull(message = "Typ pojiÅ¡tÄ›nÃ­ je povinnÃ½")
    private PolicyType type;
}</code></pre>

          <blockquote>
            <p>
              <strong>PouÄenÃ­:</strong> Validuj vÅ¡e, co pÅ™ijde zvenÄÃ­. 
              Bean Validation je tvÅ¯j kamarÃ¡d.
            </p>
          </blockquote>

          <h2>âŒ Chyba #4: Å patnÃ© HTTP status kÃ³dy</h2>
          
          <h3>Co jsem udÄ›lal Å¡patnÄ›:</h3>
          <pre><code>@GetMapping("/policies/{id}")
public Policy getPolicy(@PathVariable Long id) {
    Policy policy = policyRepository.findById(id);
    if (policy == null) {
        return null; // ğŸ˜± 200 OK s null
    }
    return policy;
}

@PostMapping("/policies")
public Policy createPolicy(@RequestBody Policy policy) {
    return policyRepository.save(policy); // ğŸ˜± 200 OK mÃ­sto 201 Created
}</code></pre>

          <h3>âœ… Jak to Å™eÅ¡Ã­m dnes:</h3>
          <pre><code>@GetMapping("/policies/{id}")
public ResponseEntity&lt;PolicyDto&gt; getPolicy(@PathVariable Long id) {
    Optional&lt;Policy&gt; policy = policyService.findById(id);
    
    if (policy.isEmpty()) {
        return ResponseEntity.notFound().build(); // 404 Not Found
    }
    
    PolicyDto dto = policyMapper.toDto(policy.get());
    return ResponseEntity.ok(dto); // 200 OK
}

@PostMapping("/policies")
public ResponseEntity&lt;PolicyDto&gt; createPolicy(@Valid @RequestBody CreatePolicyDto dto) {
    Policy policy = policyService.create(dto);
    PolicyDto responseDto = policyMapper.toDto(policy);
    
    return ResponseEntity
        .status(HttpStatus.CREATED) // 201 Created
        .header("Location", "/api/policies/" + policy.getId())
        .body(responseDto);
}</code></pre>

          <h2>âŒ Chyba #5: Business logika v controlleru</h2>
          
          <h3>Co jsem udÄ›lal Å¡patnÄ›:</h3>
          <pre><code>@PostMapping("/policies")
public Policy createPolicy(@RequestBody Policy policy) {
    // OvÄ›Å™enÃ­ klienta
    Client client = clientRepository.findById(policy.getClientId());
    if (client == null) {
        throw new RuntimeException("Klient neexistuje");
    }
    
    // VÃ½poÄet pojistnÃ©ho
    BigDecimal premium = policy.getAmount().multiply(new BigDecimal("0.05"));
    policy.setPremium(premium);
    
    // GenerovÃ¡nÃ­ ÄÃ­sla
    String number = "POL-" + System.currentTimeMillis();
    policy.setNumber(number);
    
    // OdeslÃ¡nÃ­ emailu
    emailService.sendPolicyCreated(client.getEmail(), policy);
    
    return policyRepository.save(policy);
}</code></pre>

          <h3>âœ… Jak to Å™eÅ¡Ã­m dnes:</h3>
          <pre><code>// Controller - jen orchestrace
@PostMapping("/policies")
public ResponseEntity&lt;PolicyDto&gt; createPolicy(@Valid @RequestBody CreatePolicyDto dto) {
    Policy policy = policyService.create(dto);
    PolicyDto responseDto = policyMapper.toDto(policy);
    return ResponseEntity.status(HttpStatus.CREATED).body(responseDto);
}

// Service - business logika
@Service
public class PolicyService {
    
    public Policy create(CreatePolicyDto dto) {
        validateClient(dto.getClientId());
        
        Policy policy = new Policy();
        policy.setNumber(generatePolicyNumber());
        policy.setAmount(dto.getAmount());
        policy.setPremium(calculatePremium(dto.getAmount()));
        policy.setClientId(dto.getClientId());
        
        Policy savedPolicy = policyRepository.save(policy);
        
        notificationService.sendPolicyCreated(savedPolicy);
        
        return savedPolicy;
    }
}</code></pre>

          <h2>ğŸ“ Moje checklist pro REST API dnes</h2>
          
          <h3>âœ… Struktura:</h3>
          <ul>
            <li>Jeden controller = jedna domÃ©na</li>
            <li>OddÄ›lenÃ© DTOs pro input/output</li>
            <li>Business logika v service vrstvÄ›</li>
            <li>MapovÃ¡nÃ­ mezi Entity a DTO</li>
          </ul>

          <h3>âœ… Validace:</h3>
          <ul>
            <li>Bean Validation na DTO</li>
            <li>@Valid v controlleru</li>
            <li>Custom validÃ¡tory pro sloÅ¾itÄ›jÅ¡Ã­ logiku</li>
            <li>Global exception handler</li>
          </ul>

          <h3>âœ… HTTP konvence:</h3>
          <ul>
            <li>200 OK - ÃºspÄ›Å¡nÃ© ÄtenÃ­</li>
            <li>201 Created - ÃºspÄ›Å¡nÃ© vytvoÅ™enÃ­</li>
            <li>204 No Content - ÃºspÄ›Å¡nÃ© smazÃ¡nÃ­</li>
            <li>400 Bad Request - chyby validace</li>
            <li>404 Not Found - nenalezeno</li>
            <li>500 Internal Server Error - server chyby</li>
          </ul>

          <h3>âœ… TestovÃ¡nÃ­:</h3>
          <ul>
            <li>Unit testy pro service vrstvu</li>
            <li>Integration testy pro controllery (@SpringBootTest)</li>
            <li>MockMvc pro testovÃ¡nÃ­ endpointÅ¯</li>
            <li>TestContainers pro databÃ¡zovÃ© testy</li>
          </ul>

          <h2>ğŸ’¡ Tipy pro zaÄÃ¡teÄnÃ­ky</h2>
          
          <ol>
            <li><strong>ZaÄni malÃ©</strong> - PrvnÃ­ API nech jednoduchÃ©, komplexnost pÅ™idej pozdÄ›ji</li>
            <li><strong>NÃ¡sleduj konvence</strong> - REST mÃ¡ svoja pravidla, respektuj je</li>
            <li><strong>Testuj od zaÄÃ¡tku</strong> - Testy ti ukÃ¡Å¾ou chyby dÅ™Ã­v neÅ¾ uÅ¾ivatelÃ©</li>
            <li><strong>PouÅ¾Ã­vej nÃ¡stroje</strong> - Postman, Swagger, Spring Boot Actuator</li>
            <li><strong>ÄŒti cizÃ­ kÃ³d</strong> - Koukej jak to dÄ›lajÃ­ jinÃ­ na GitHubu</li>
          </ol>

          <h2>ğŸ ZÃ¡vÄ›r</h2>
          <p>
            Moje prvnÃ­ API byla katastrofa. Ale kaÅ¾dÃ¡ chyba mÄ› nÄ›co nauÄila. 
            Dnes pÃ­Å¡u ÄistÅ¡Ã­ kÃ³d, lepÅ¡Ã­ architekturu a mÃ©nÄ› bugÅ¯.
          </p>
          
          <p>
            <strong>NejdÅ¯leÅ¾itÄ›jÅ¡Ã­ pouÄenÃ­:</strong> Neboj se dÄ›lat chyby. 
            Refaktoring je normÃ¡lnÃ­ ÄÃ¡st vÃ½voje. Tvoje prvnÃ­ API nebude dokonalÃ© - a to je v poÅ™Ã¡dku.
          </p>

          <blockquote>
            <p>
              "Code is never finished, only abandoned." - anonymous developer
            </p>
          </blockquote>

          <p>
            MÅ¯j SprÃ¡vce pojiÅ¡tÄ›nÃ­ API proÅ¡el uÅ¾ tÅ™emi velkÃ½mi refactoringy. 
            A poÅ™Ã¡d najdu vÄ›ci, kterÃ© by Å¡ly udÄ›lat lÃ©pe. To je krÃ¡sa programovÃ¡nÃ­ - 
            vÅ¾dycky se mÃ¡Å¡ kam posunout! ğŸš€
          </p>

          <hr>

          <p>
            <em>
              MÃ¡Å¡ zkuÅ¡enosti s tvorbou prvnÃ­ho API? Nebo se chystÃ¡Å¡ na to? 
              <a href="../index.html#kontakt">NapiÅ¡ mi</a> - rÃ¡d si vymÄ›nÃ­me tipy a triky!
            </em>
          </p>
        </div>
      </article>

      <div class="article-navigation">
        <a href="../index.html#clanky" class="btn outline">â† ZpÄ›t na ÄlÃ¡nky</a>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>&copy; 2025 codebydejv. VytvoÅ™eno s â¤ï¸ a Javou.</p>
    </div>
  </footer>

  <style>
    .article-main {
      padding: 2rem 0 4rem;
      margin-top: 4rem;
    }
    
    .article {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .article-header {
      margin-bottom: 3rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--border);
    }
    
    .article-meta {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    
    .article h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 1rem;
      line-height: 1.2;
    }
    
    .article-excerpt {
      font-size: 1.25rem;
      color: var(--text-muted);
      margin-bottom: 1.5rem;
    }
    
    .article-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .tag {
      background: var(--bg-muted);
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .article-content {
      line-height: 1.7;
    }
    
    .article-content h2 {
      margin: 2.5rem 0 1rem;
      font-size: 1.75rem;
      font-weight: 700;
    }
    
    .article-content h3 {
      margin: 2rem 0 1rem;
      font-size: 1.25rem;
      font-weight: 600;
    }
    
    .article-content p {
      margin-bottom: 1.5rem;
    }
    
    .article-content ul, .article-content ol {
      margin: 1.5rem 0;
      padding-left: 2rem;
    }
    
    .article-content li {
      margin-bottom: 0.5rem;
    }
    
    .article-content blockquote {
      margin: 2rem 0;
      padding: 1.5rem;
      background: var(--bg-muted);
      border-left: 4px solid var(--primary);
      border-radius: 0.5rem;
      font-style: italic;
    }
    
    .article-content code {
      background: var(--bg-muted);
      padding: 0.2rem 0.4rem;
      border-radius: 0.25rem;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    
    .article-content pre {
      background: var(--bg-muted);
      padding: 1.5rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin: 1.5rem 0;
    }
    
    .article-content pre code {
      background: none;
      padding: 0;
    }
    
    .article-content hr {
      margin: 3rem 0;
      border: none;
      border-top: 1px solid var(--border);
    }
    
    .article-navigation {
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border);
    }
    
    .site-footer {
      background: var(--bg-muted);
      padding: 2rem 0;
      text-align: center;
      color: var(--text-muted);
    }
  </style>
</body>
</html>
